# 社团管理系统数据库设计
## 一、数据库表设计
- 1. members 表（成员信息表）
```sql
CREATE TABLE members (
    id INT PRIMARY KEY AUTO_INCREMENT,
    name VARCHAR(50) NOT NULL,
    student_id VARCHAR(20) NOT NULL UNIQUE,
    major VARCHAR(100) NOT NULL,
    join_date DATE NOT NULL,
    attendance_rate DECIMAL(5,2) DEFAULT 0,
    status ENUM('active', 'inactive', 'pending') NOT NULL DEFAULT 'pending',
    role ENUM('member', 'manager', 'admin') NOT NULL DEFAULT 'member',
    phone VARCHAR(20),
    email VARCHAR(100),
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    INDEX idx_student_id (student_id),
    INDEX idx_status (status)
);
```
- 2. activities 表（活动信息表）
```sql
CREATE TABLE activities (
    id INT PRIMARY KEY AUTO_INCREMENT,
    name VARCHAR(100) NOT NULL,
    description TEXT,
    start_time DATETIME NOT NULL,
    end_time DATETIME NOT NULL,
    location VARCHAR(200) NOT NULL,
    max_participants INT NOT NULL DEFAULT 0,
    current_participants INT NOT NULL DEFAULT 0,
    status ENUM('draft', 'pending', 'approved', 'completed', 'canceled') NOT NULL DEFAULT 'draft',
    created_by VARCHAR(50) NOT NULL,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    INDEX idx_status (status),
    INDEX idx_start_time (start_time)
);
```
- 3.applications 表（申请记录表）
```sql
CREATE TABLE applications (
    id INT PRIMARY KEY AUTO_INCREMENT,
    applicant_name VARCHAR(50) NOT NULL,
    applicant_id VARCHAR(20) NOT NULL,
    contact_info VARCHAR(100) NOT NULL,
    event_name VARCHAR(100) NOT NULL,
    event_date DATE NOT NULL,
    location VARCHAR(200) NOT NULL,
    reason TEXT NOT NULL,
    application_time DATETIME NOT NULL,
    status ENUM('pending', 'approved', 'rejected') NOT NULL DEFAULT 'pending',
    process_time DATETIME,
    processor_name VARCHAR(50),
    process_comment TEXT,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    INDEX idx_status (status),
    INDEX idx_applicant_id (applicant_id)
);
```
- 4. users（用户表）
```sql
CREATE TABLE users (
    id INT PRIMARY KEY AUTO_INCREMENT,
    username VARCHAR(50) NOT NULL UNIQUE,
    password VARCHAR(255) NOT NULL,
    role VARCHAR(20) NOT NULL DEFAULT '管理员',
    club_manager VARCHAR(100),
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    INDEX idx_username (username)
);
```
- 5. activity_participants（活动参与记录表）
```sql
CREATE TABLE activity_participants (
    id INT PRIMARY KEY AUTO_INCREMENT,
    activity_id INT NOT NULL,
    member_id INT NOT NULL,
    participation_time DATETIME DEFAULT CURRENT_TIMESTAMP,
    attendance_status ENUM('present', 'absent', 'late', 'excused') DEFAULT NULL,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (activity_id) REFERENCES activities(id) ON DELETE CASCADE,
    FOREIGN KEY (member_id) REFERENCES members(id) ON DELETE CASCADE,
    UNIQUE KEY uk_activity_member (activity_id, member_id),
    INDEX idx_activity_id (activity_id),
    INDEX idx_member_id (member_id)
);
```
- 6. attendance_records（出勤记录表）
```sql
CREATE TABLE attendance_records (
    id INT PRIMARY KEY AUTO_INCREMENT,
    activity_id INT NOT NULL,
    member_id INT NOT NULL,
    attendance_time DATETIME DEFAULT CURRENT_TIMESTAMP,
    status ENUM('present', 'absent', 'late', 'excused') NOT NULL,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (activity_id) REFERENCES activities(id) ON DELETE CASCADE,
    FOREIGN KEY (member_id) REFERENCES members(id) ON DELETE CASCADE,
    UNIQUE KEY uk_activity_member_record (activity_id, member_id),
    INDEX idx_activity_id (activity_id),
    INDEX idx_member_id (member_id)
);
```

## 二、API接口设计
### 1. 认证管理
- 1.1 登录
```json
URL: /api/auth/login

方法: POST

请求体: {
        "username": "string",
        "password": "string"
       }
成功响应: {
  "token": "string", 
  "userInfo":
       {
        "username": "string",
        "role": "string",
         "社团管理员": "string"
        }
  }
失败响应: {"error": "string"}
```
- 1.2 登出
```json
URL: /api/auth/logout
方法: POST
请求头: Authorization: Bearer {token}
成功响应: {"message": "success"}
```

- 1.3 验证Token
```json
URL: /api/auth/verify
方法: GET
请求头: Authorization: Bearer {token}
成功响应: {"valid": true, "userInfo": {...}}
失败响应: {"valid": false}
```
### 2. 成员管理
- 2.1 获取成员列表
```json
URL: /api/members
方法: GET
查询参数: ?page=1&limit=10&search=xxx&status=active
成功响应: {"total": 100, "items": [{"id": 1, "name": "张三", ...}]}
```

- 2.2 获取单个成员
```json
URL: /api/members/{id}
方法: GET
成功响应: {"id": 1, "name": "张三", ...}
```
- 2.3 添加成员
```json
URL: /api/members
方法: POST
请求体: {"name": "string", "studentId": "string", "major": "string", ...}
成功响应: {"id": 1, "name": "string", ...}
```
- 2.4 更新成员
```json
URL: /api/members/{id}
方法: PUT
请求体: {"name": "string", "status": "active", ...}
成功响应: {"id": 1, "name": "string", ...}
```
- 2.5 删除成员
```json
URL: /api/members/{id}
方法: DELETE
成功响应: {"message": "success"}
```
- 2.6 获取成员统计
```json
URL: /api/members/stats
方法: GET
成功响应: {"total": 100, "active": 80, "inactive": 15, "pending": 5, "averageAttendance": 85.5}
```
- 2.7 导出成员列表
```json
URL: /api/members/export
方法: GET
查询参数: ?status=active
成功响应: 文件下载 (CSV格式)
```
### 3. 活动管理
- 3.1 获取活动列表
```json
URL: /api/activities
方法: GET
查询参数: ?page=1&limit=10&search=xxx&status=approved
成功响应: {"total": 50, "items": [{"id": 1, "name": "街舞合作班", ...}]}
```
- 3.2取单个活动
```json
URL: /api/activities/{id}
方法: GET
成功响应: {"id": 1, "name": "街舞合作班", ...}
```
- 3.3 创建活动
```json
URL: /api/activities
方法: POST
请求体: {"name": "string", "description": "string", "startTime": "2024-02-15 19:00", ...}
成功响应: {"id": 1, "name": "string", ...}
```
- 3.4 更新活动
```json
URL: /api/activities/{id}
方法: PUT
请求体: {"name": "string", "status": "approved", ...}
成功响应: {"id": 1, "name": "string", ...}
```
- 3.5 删除活动
```json
URL: /api/activities/{id}
方法: DELETE
成功响应: {"message": "success"}
```
- 3.6 获取活动统计
```json
URL: /api/activities/stats
方法: GET
成功响应: {"total": 50, "approved": 35, "pending": 10, "completed": 5}
```
- 3.7 获取活动参与者列表
```json
URL: /api/activities/{id}/participants
方法: GET
成功响应: {"total": 20, "items": [{"id": 1, "member_id": 1, "member_name": "张三", ...}]}
```
### 4. 申请管理

- 4.1 获取申请列表
```json
URL: /api/applications
方法: GET
查询参数: ?page=1&limit=10&search=xxx&status=pending
成功响应: {"total": 30, "items": [{"id": 1, "applicantName": "张三", ...}]}
```
- 4.2 获取单个申请
```json
URL: /api/applications/{id}
方法: GET
成功响应: {"id": 1, "applicantName": "张三", ...}
```
- 4.3 创建申请
```json
URL: /api/applications
方法: POST
请求体: {"applicantName": "string", "applicantId": "string", ...}
成功响应: {"id": 1, "applicantName": "string", ...}
```
- 4.4 处理申请
```json
URL: /api/applications/{id}/process
方法: PUT
请求体: {"status": "approved", "processorName": "管理员", "processComment": "批准申请"}
成功响应: {"id": 1, "status": "approved", ...}
```
- 4.5 删除申请
```json
URL: /api/applications/{id}
方法: DELETE
成功响应: {"message": "success"}
```
- 4.6 获取申请统计
```json
URL: /api/applications/stats
方法: GET
成功响应: {"total": 30, "pending": 10, "approved": 15, "rejected": 5}
```
- 4.7 导出申请记录
```json
URL: /api/applications/export
方法: GET
查询参数: ?status=all
成功响应: 文件下载 (CSV格式)
```
### 5. 仪表盘数据
- 5.1 获取仪表盘概览数据
```json
URL: /api/dashboard/overview
方法: GET
成功响应: {"totalMembers": 125, "activeMembers": 89, "totalActivities": 42, "pendingApplications": 7, "approvalRate": "85%"}
```
- 5.2 获取最近活动
```json
URL: /api/dashboard/recent-activities
方法: GET
成功响应: [{"id": 1, "name": "春季招新活动", "date": "2024-03-15", "participants": 68, "status": "completed"}]
```
- 5.3 获取活动类型分布
```json
URL: /api/dashboard/activity-types
方法: GET
成功响应: [{"value": 35, "name": "技术分享"}, {"value": 25, "name": "团建活动"}, ...]
```
- 5.4 获取成员增长趋势
```json
URL: /api/dashboard/member-growth
方法: GET
查询参数: ?months=6
成功响应: {"months": ["1月", "2月", "3月", "4月", "5月", "6月"], "numbers": [23, 35, 42, 38, 52, 68]}
```
### 6. 出勤管理
- 6.1 记录活动出勤
```json
URL: /api/attendance
方法: POST
请求体: {"activityId": 1, "memberId": 1, "status": "present"}
成功响应: {"id": 1, "activityId": 1, "memberId": 1, ...}
```
- 6.2 获取活动出勤记录
```json
URL: /api/activities/{id}/attendance
方法: GET
成功响应: {"total": 20, "items": [{"id": 1, "member_id": 1, "member_name": "张三", "status": "present"}]}
```
## 三、技术实现要点
- 认证机制：使用JWT进行身份验证，token存储在localStorage中
- 数据验证：对所有API输入进行严格的数据验证和参数校验
- 错误处理：统一的错误处理机制，返回友好的错误信息
- 分页处理：所有列表查询API都支持分页功能
- 搜索和筛选：支持按关键字搜索和状态筛选
- 数据导出：支持导出CSV格式的数据文件
- 统计计算：实时计算各类统计数据，如出勤率、审批率等
- 事务管理：对关键操作使用事务保证数据一致性
- 索引优化：为常用查询字段建立索引提升性能
- 跨域处理：配置CORS支持前端访问